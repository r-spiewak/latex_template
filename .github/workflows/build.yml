env:
  PACKAGE_NAME: unnamed

name: Build and Release LaTeX Package
# This should be triggered for a tagged release, such as:
# git tag v1.0.0
# git push origin v1.0.0
on:
  push:
    tags:
      - 'v*'
      # - v[0-9]+(\.[0-9]+)*([-\.]\S+)?
jobs:
  build:
    # if: ${{ github.ref == 'refs/heads/main' }}
    runs-on: ubuntu-latest
    steps:  
    - uses: actions/checkout@v4
    - name: Set up TeX Live
      uses: teatimeguest/setup-texlive-action@v3
      with:
        repository: http://ctan.math.utah.edu/tex-archive/systems/texlive/tlnet
        packages: >-
          latex-bin
          latexmk
          scheme-basic
          catchfile
          silence
          # filecontents
    - name: Generate .sty from .ins
      if: ${{ runner.os == 'Linux' }}
      run: pdflatex $PACKAGE_NAME.ins
    - name: Upload .sty as artifact
      if: ${{ runner.os == 'Linux' }}
      uses: actions/upload-artifact@v4
      with:
        name: $PACKAGE_NAME-sty
        path: $PACKAGE_NAME.sty
    - name: Create GitHub release
      uses: softprops/action-gh-release@v1
      if: startsWith(github.ref, 'refs/tags/')
      with:
        files: |
          $PACKAGE_NAME.sty
          $PACKAGE_NAME.dtx
          $PACKAGE_NAME.ins
          README.md
    - name: Create CTAN zip bundle
      run: zip $PACKAGE_NAME.zip $PACKAGE_NAME.dtx $PACKAGE_NAME.ins $PACKAGE_NAME.sty README.md
    
